{"version":3,"sources":["../../Finance_api/routes/users.js"],"names":["express","require","router","Router","User","passport","validateRegisterInput","validateLoginInput","post","req","res","body","errors","isValid","flash","redirect","findOne","email","check","create","next","authenticate","err","user","info","logIn","module","exports"],"mappings":";;;;;;;;AAAA,IAAMA,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,IAAMC,MAAM,GAAGF,OAAO,CAACG,MAAR,EAAf;;AACA,IAAMC,IAAI,GAAGH,OAAO,CAAC,iBAAD,CAApB;;AACA,IAAMI,QAAQ,GAAGJ,OAAO,CAAC,oBAAD,CAAxB,C,CAEA;;;AACA,IAAMK,qBAAqB,GAAGL,OAAO,CAAC,wBAAD,CAArC;;AACA,IAAMM,kBAAkB,GAAGN,OAAO,CAAC,qBAAD,CAAlC,C,CACA;;;AAEAC,MAAM,CAACM,IAAP,CAAY,WAAZ;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAyB,iBAAOC,GAAP,EAAYC,GAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AACvB;AADuB,oCAEKJ,qBAAqB,CAACG,GAAG,CAACE,IAAL,CAF1B,EAEfC,MAFe,yBAEfA,MAFe,EAEPC,OAFO,yBAEPA,OAFO,EAGvB;;AAHuB,gBAIlBA,OAJkB;AAAA;AAAA;AAAA;;AAKrBJ,YAAAA,GAAG,CAACK,KAAJ,CAAU,aAAV,EAAyBF,MAAzB;AALqB,6CAMdF,GAAG,CAACK,QAAJ,CAAa,MAAb,CANc;;AAAA;AAAA;AAAA,mBAQHX,IAAI,CAACY,OAAL,CAAa;AAAEC,cAAAA,KAAK,EAAER,GAAG,CAACE,IAAJ,CAASM;AAAlB,aAAb,CARG;;AAAA;AAQjBC,YAAAA,KARiB;;AAAA,iBASjBA,KATiB;AAAA;AAAA;AAAA;;AAUnBT,YAAAA,GAAG,CAACK,KAAJ,CAAU,aAAV,EAAyB,sBAAzB;AAVmB,6CAWZJ,GAAG,CAACK,QAAJ,CAAa,MAAb,CAXY;;AAAA;AAAA;AAAA,mBAabX,IAAI,CAACe,MAAL,CAAYV,GAAG,CAACE,IAAhB,CAba;;AAAA;AAcnBF,YAAAA,GAAG,CAACK,KAAJ,CAAU,aAAV,EAAyB,iDAAzB;AAdmB,6CAeZJ,GAAG,CAACK,QAAJ,CAAa,GAAb,CAfY;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAzB;;AAAA;AAAA;AAAA;AAAA;AAoBAb,MAAM,CAACM,IAAP,CAAY,QAAZ;AAAA;AAAA;AAAA;AAAA;AAAA,+BAAsB,kBAAOC,GAAP,EAAYC,GAAZ,EAAiBU,IAAjB;AAAA;AAAA;AAAA;AAAA;AACpBf,YAAAA,QAAQ,CAACgB,YAAT,CAAsB,OAAtB,EAA+B,UAAUC,GAAV,EAAeC,IAAf,EAAqBC,IAArB,EAA2B;AACxD,kBAAIF,GAAJ,EAAS,OAAOF,IAAI,CAACE,GAAD,CAAX;;AACT,kBAAI,CAACC,IAAL,EAAW;AACTd,gBAAAA,GAAG,CAACK,KAAJ,CAAU,aAAV,EAAyB,4BAAzB;AACA,uBAAOJ,GAAG,CAACK,QAAJ,CAAa,MAAb,CAAP;AACD;;AACDN,cAAAA,GAAG,CAACgB,KAAJ,CAAUF,IAAV,EAAgB,UAAUD,GAAV,EAAe;AAC7B,oBAAIA,GAAJ,EAAS,OAAOF,IAAI,CAACE,GAAD,CAAX;AACT,uBAAOZ,GAAG,CAACK,QAAJ,CAAa,OAAb,CAAP;AACD,eAHD;AAID,aAVD,EAUGN,GAVH,EAUQC,GAVR,EAUaU,IAVb;;AADoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAtB;;AAAA;AAAA;AAAA;AAAA;AAcAM,MAAM,CAACC,OAAP,GAAiBzB,MAAjB","sourcesContent":["const express = require(\"express\");\r\nconst router = express.Router();\r\nconst User = require('../models/users');\r\nconst passport = require('../config/passport');\r\n\r\n// Load input validation\r\nconst validateRegisterInput = require(\"../validation/register\");\r\nconst validateLoginInput = require(\"../validation/login\");\r\n// Load User model\r\n\r\nrouter.post(\"/register\", async (req, res) => {\r\n  // Form validation\r\n  const { errors, isValid } = validateRegisterInput(req.body);\r\n  // Check validation\r\n  if (!isValid) {\r\n    req.flash('success_msg', errors);\r\n    return res.redirect('back');\r\n  } else {\r\n    let check = await User.findOne({ email: req.body.email });\r\n    if (check) {\r\n      req.flash('success_msg', 'Email already in use');\r\n      return res.redirect('back');\r\n    } else {\r\n      await User.create(req.body);\r\n      req.flash('success_msg', 'Account created successfully, you can now login');\r\n      return res.redirect('/');\r\n    }\r\n  }\r\n});\r\n\r\nrouter.post(\"/login\", async (req, res, next) => {\r\n  passport.authenticate('local', function (err, user, info) {\r\n    if (err) return next(err)\r\n    if (!user) {\r\n      req.flash('success_msg', 'Incorect Email or password');\r\n      return res.redirect('back');\r\n    }\r\n    req.logIn(user, function (err) {\r\n      if (err) return next(err);\r\n      return res.redirect('/home');\r\n    });\r\n  })(req, res, next);\r\n});\r\n\r\nmodule.exports = router;\r\n"],"file":"users.js"}